# nlp_project

# Корпус русских народных сказок
Корпус состоит из 120 русских народных сказок. Сказки взяты с сайта https://skazki-pesni.ru.

## База данных
В файле 'fairy_tales_razdel_full.csv' хранятся данные всех сказок. Сказки были разделены по предложениям. Столбцы: 
- 'sents' - предложения из сказок,
- 'name' - название сказки,
- 'href' - ссылка на сказку,
- 'sent_without' - предложения без знаков препинания.

В файле 'corpus.csv' добавляется информация о словах, входящих в предложение.
- 'tokens' - токены,
- 'pos_tags' - падежи слов,
- 'lemmas' - леммы слов.

## Requirements
- запускать сайт на версии python 3.10
- blinker==1.8.2
- click==8.1.7
- DAWG-Python==0.7.2
- docopt==0.6.2
- Flask==3.0.3
- itsdangerous==2.2.0
- Jinja2==3.1.4
- joblib==1.4.2
- MarkupSafe==3.0.2
- nltk==3.9.1
- numpy==2.1.2
- pandas==2.2.3
- pymorphy2==0.9.1
- pymorphy2-dicts-ru==2.4.417127.4579844
- python-dateutil==2.9.0.post0
- pytz==2024.2
- regex==2024.9.11
- six==1.16.0
- tqdm==4.66.6
- tzdata==2024.2
- Werkzeug==3.0.6
  
## Основные используемые библиотеки 
- fake_useragent - парсинг;
- nltk - токенизация;
- pymorphy2 - лемматизация;
- Natasha - POS-теггинг и лемматизация;
- pandas - создание DataFrame;
- re - написание регулярных выражений.

## Работа корпуса

Программа разделена на несколько блоков.
1. Парсинг
   - Для обхода защиты сайта использовался fake_useragent.
   - Функция get_nth_page обрабатывает одну страницу сайта (вычленяет текст, название, ссылку на сказку)
   - Функция run_all принимает количество страниц с сайта и обрабатывает их по-странично.
  
2. Создание базы данных
   - Разбиваем все тексты на предложения, создаем колонки для всех предложений, названий сказок, ссылок на сказки, предложений без пунктуации.
   - Записываем все в файл 'fairy_tales_razdel_full.csv'.
     
3. Обработка запроса и поиск предложений

   3.1. Лемматизация, токенизация, POS-tagging
   - Выполняем POS-теггинг, токенезацию, лемматизацию с помощью Natasha и pymorphy2.
   - Результаты сохраняем в файл 'corpus.csv'.
   
   3.2. Проверка конкретного слова на соответствие запросу
   - Функция check_word_form - функция для проверки всех форм слова, игнорируя регистр.
   - Функция check_exact_form - функция для проверки точной формы слова без учета регистра.
   - Функция check_lemma_and_pos - функция для проверки по лемме и тегу части речи.
   - Функция check_pos - функция для проверки соответствия частеречного тега.
   - Функция word_fits_request_part - функция для вызова нужной из четырех функций выше в зависимости от запроса.

   3.3. Основная функция поиска
   - Функция search - основная функция, которая может принимать слово, слово в кавычках, лемма+POS-tag, POS-tag.
   - Возвращает предложения, подходящие под запрос, вместе с источником и ссылкой на источник.

4. Поиск коллокаций
   - Функция get_collocations - функция для поиска коллокаций, принимает слово, возвраащет коллокации с этим словом и их количество.
  
5. Итоговая программа

   5.1. Вывод найденных примеров
   - Функция pretty_line - функция для выравнивая контекстов определенного примера.
   - Функция get_all_pretty_lines - функция, которая выводит все найденные примеры (выровненные).
     
   5.2. Взаимодействие с программой (см.Взаимодействие пользователя с корпусом)
      

## Взаимодействие пользователя с корпусом

1. Пользователь вводит интересующее его слово, слово в кавычках, лемма+POS-tag, POS-tag.
2. Вывод программы состоит из:
   * предложений, которые содержат все предложения с этим запросом с разделением на левый, центральный, правый контексты и с указанием на источник и название сказки.
   * коллокаций с их частотностью.

   __Пример: ввод пользователя - 'лисичка'__

     *Забралась | лисичка   | в теремок. || Предложение из Теремок https://skazki-pesni.ru/teremok/*
     
     *Жили-были в лесу | лисичка   | и зайка. || Предложение из Заюшкина избушка https://skazki-pesni.ru/zayushkina-izbushka/*

     
     *с лисичкой | 3*
     
     *лисичкой близко | 3*
     
     *пришла лисичка | 3*

   __Пример: ввод пользователя - 'ADV NOUN'__

     *Бежит | мимо мышка-норушка.| || Предложение из Теремок https://skazki-pesni.ru/teremok/*

     *Бежит | мимо зайчик-побегайчик.| || Предложение из Теремок https://skazki-pesni.ru/teremok/*
   
## Сложные случаи
1. Неправильная работа библиотеки Pymorphy2. Из-за того, что разметка корпуса автоматическая, не все леммы правильно определялись. Например, в предложении 'Стоит в поле теремок' библиотека Pymorphy2 определяет 'стоить', как начальную форму слова 'стоит'.
2. Слова с дефисами. Так как тексты нашего корпуса - сказки, часто встречаются такие формы слов, как 'стоит-шатается' и подобные. Такие случаи вызывают затруднения автоматической разметки, из-за чего возникают сложные случаи в определении частей речи.
3. Знаки препинания. Есть тексты, в которых между знаками препинания стоят пробелы. Из-за пробелов токенезация может быть неправильной, следовательно, на дальнейших этапах сбивается определение центральных контекстов и коллокаций.
4. Н-граммы. Для определения частей речи использовалась библиотека Natasha. Из-за автоматической обработки она не всегда корректно работала при POS-tagging'е, что вызывало неправильный вывод биграмм и триграмм.
5. Проблемы корпуса. В текстах корпуса есть довольно много ошибок, которые приводят к неправильному автоматическому разбору: лишние пробелы, неправильно написанные слова (например, в слове 'забралась' первый знак - цифра 3, поэтому программа разбивает на 2 токена: '3' и 'абралаcь'.
   Из-за лишних пробелов может сбиваться вывод результатов (предложения и коллокации), однако несмотря на это, функции поиска по запросу работают корректно.

## Сайт
Чтобы запустить сайт локально используйте файлы в папке web. В интернете он лежит на skazocnyj-korpus-mayyagore.amvera.io
   
## Поддержка
Если у Вас возникли вопросы относительно работы корпуса, Вы можете их задать авторам проекта, написав в телеграмме. Мы всегда будем рады Вам ответить!

- Майя Горшенина - @latentgypsy
- Заряна Дамашова - @Mr_ushanovich
- Софья Черноусенко - @carasinaa
- София Герен - @ssofiyk


